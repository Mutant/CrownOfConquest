[% INCLUDE top.html %]

<script>
function acceptQuest(quest_id) {
	dojo.xhrGet( {
        url: "[% base %]/quest/accept?quest_id=" + quest_id, 
        handleAs: "text",
        
        load: function(responseObject, ioArgs) {
        	if (responseObject) {
        		dojo.byId('accept-message-text').innerHTML = responseObject;
        		dijit.byId('message').show();
        	}
        
        	dojo.byId('offer').innerHTML = dojo.byId('accepted').innerHTML;
        }
    });
}

</script>

[% IF party_below_min_level %]

<div dojoType="dijit.Dialog" id="level-warning" style="display: none" title="Warning">
    Your party's level isn't high enough to accept this quest!
    <br>
	<div align="center">
    	<button dojoType=dijit.form.Button type="submit">OK</button>
	</div>
</div>

<script>
	function showWarning() { dijit.byId('level-warning').show() }
	dojo.addOnLoad( showWarning );
</script>

[% END %]

[% PROCESS quest/description.html %]

<div dojoType="dijit.Dialog" id="message" style="display: none" title="Message">
    <span id="accept-message-text"></span>
    <br>
	<div align="center">
    	<button dojoType=dijit.form.Button type="submit">OK</button>
	</div>
</div>

<h2>[% short_description(quest) %]</h2>

<p>
[% UNLESS party_below_min_level %]
	The towns people of [% town.town_name %] have offered you the following quest:
[% ELSE %]
	You look on forlornly at the quest you'd be offered if only your party was level [% quest.min_level %] or higher... 
[% END %]
</p>

[% long_description(quest) %]

Reward: [% quest.gold_value %] gold<br>
Days To Complete: [% quest.days_to_complete %]<br> 

[% UNLESS party_below_min_level %]
<p>Do you want to accept this quest?</p>

<div id="offer"><a href="javascript:acceptQuest('[% quest.id %]')">Yes</a> <a href="[% base %]">No</a></div>

<div id="accepted" style="visibility: hidden">Quest Accepted! <a href="[% base %]">Back To Town</a></div>
[% ELSE %]
<br><a href="[% base %]">Back To Town</a>
[% END %]

[% INCLUDE bottom.html %]