[% PROCESS equipment/grid.html %]
[% MACRO display_equipped_item(equipped_items, slot_orig) BLOCK %]
	[% equip_place = equip_places.$slot_orig %]
	[% item = equipped_items.$slot_orig %]
	<td id="equip_place_[% equip_place.id %]" class="equip-slot" align="center" style="border: #2F2F2F 1px dashed" 
		height="[% equip_place.height * 40 %]" width="[% equip_place.width * 40 %]" slot="[% equip_place.equip_place_name %]"
		slotName="[% slot_orig %]">
		[% IF item %]
			[% item_div("inventory", item) %]
		[% ELSE %]
			[% slot_orig %]
		[% END %]
	</td>
[% END %]

<script>
[% FOREACH slot_data IN equip_places %]
	[% slot = slot_data.value %] 
	$( "#equip_place_[% slot.id %]" ).droppable({
		accept: "[% FOREACH category IN equip_place_category_list.${slot.equip_place_name} %].[% category | lower | replace('\s+', '_') %]-category, [% END %]",
		drop: function( event, ui ) {
			dropItemOnEquipSlot(event, ui, $(this), '[% character.id %]');
		},
		hoverClass: "item-droppable",			
	});
[% END %]

function addCommonMenuItems(menu) {
	var giveSubMenu = new dijit.Menu();

	[% FOREACH char_in_party IN allowed_to_give_to_characters %]
		[% UNLESS char_in_party.character_id == character.id %]
			params = {
				label: "[% char_in_party.name | html_entity %]",
				onClick: function() {
					give_item_to('[% char_in_party.id %]', currentItemId);
				}
			};
			
			var item = new dijit.MenuItem(params,document.createElement("div"));
			giveSubMenu.addChild(item);			
		[% END %]
	[% END %]

	params = {
		label: "Give Item To",
		popup: giveSubMenu,
		iconClass: "menuExpandIcon"
	};			
	var givePopupMenu = new dijit.PopupMenuItem(params);
	menu.addChild(givePopupMenu);	

	params = {
		label: "Drop Item",
		onClick: function() {
			drop_item_diag(currentItemId, '[% character.id %]');
		}
	};			
	var dropItem = new dijit.MenuItem(params,document.createElement("div"));
	menu.addChild(dropItem);	
}

setupInventory('[% character.id %]');

createItemMenus();

</script>

<div style="background: black; margin: 0px; padding: 0px; height: 100%" id="equipment-tab">

<div style="float: left">
	<b>Equipped Items</b>
	<br><br>
	<table class="main">
		<tr>
			<td></td>
			[% display_equipped_item(equipped_items, 'Head') %]
			<td></td>
		</tr>
		<tr>
			[% display_equipped_item(equipped_items, 'Left Ring Finger') %]
			[% display_equipped_item(equipped_items, 'Neck') %]
			[% display_equipped_item(equipped_items, 'Right Ring Finger') %]			
		<tr>
			[% display_equipped_item(equipped_items, 'Left Hand') %]
			[% display_equipped_item(equipped_items, 'Torso and Legs') %]
			[% display_equipped_item(equipped_items, 'Right Hand') %]
		</tr>	
	</table>
</div>

<div style="float: left; margin-left: 10px">

<b>Inventory</b> <span style="font-size: 10px"><a href="javascript:organiseInventory('[% character.id %]')">Organise</a></span>

<div id="inventory-outer">
[% create_grid('inventory', items_in_grid, 8, 14) %]
</div>

</div>