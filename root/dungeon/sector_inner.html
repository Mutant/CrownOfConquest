[% FILTER collapse %]
	[% IF sector %]
		[% border = "" %]
		[% sides_with_walls = sector.sides_with_walls %]
		[% FOREACH side IN positions  %]
			[% border_color = "#6B654E" %]
			[% FOREACH side_with_wall IN sides_with_walls %]
				[% IF side_with_wall == side %]
					[% border_color = "black" %]
				[% END %]
			[% END %]				
		
			[% border = border _ "border-" _ side _ ": 1px solid " _  border_color _ "; " %]
		[% END %] 
		
		[% can_move_to_sector = 0 %]
		[% IF allowed_to_move_to.${sector.dungeon_grid_id} && ! in_combat %]
			[% can_move_to_sector =  1 %]
		[% END %]
		
		[% IF can_move_to_sector %]
			<a href = "javascript:getPanels('/[% dungeon_type %]/move_to?sector_id=[% sector.dungeon_grid_id %]')" 
				style="text-decoration: none;">
		[% END %]
		
		[% background_image = 'floor.PNG' %]
		[% IF viewable_sectors.$x.$y || current_location.id == sector.dungeon_grid_id %]
		 	[% background_image = 'brightfloor.PNG' %]
		[% END %]		
	
		<div style="
			[% border %]
			width: [% size %]px; 
			height: [% size %]px; 
			position: absolute;
			background-image: url('[% c.config.static_path %]/images/dungeon/[% background_image %]');
			font-size: [% size / 2 %]px;
			text-align: center;			
			"
			>
						
			[% IF sector.stairs_up %]
				<img src="[% c.config.static_path %]/images/dungeon/stairs.PNG" border=0 width=[% size %] height=[% size %]>
			[% ELSIF sector.treasure_chest %]
				<img src="[% c.config.static_path %]/images/dungeon/treasure_chest.png" border=0  width=[% size %] height=[% size %]>
			[% ELSIF cgs.$x.$y %]
				[% monster_image = cgs.$x.$y.group_size > 5 ? 'monsters-lot.PNG' : 'monsters-few.PNG' %]
			
				<span id="m_[% x _ y %]"><img src="[% c.config.static_path %]/images/dungeon/[% monster_image %]" border=0 width=[% size %] height=[% size %]></span>
			    [% IF create_tooltips %]
			    <div 
					dojoType="dijit.Tooltip" 
					connectId="m_[% x _ y %]"								
					label="[% INCLUDE combat/creature_group_summary.html creature_group=cgs.$x.$y %]"></div>
				[% END %]
			[% ELSIF parties.$x.$y %]
				<span id="p_[% x _ y %]"><img src="[% c.config.static_path %]/images/dungeon/party.PNG" border=0  width=[% size %] height=[% size %]></span>
			    [% IF create_tooltips %]
			    <div 
					dojoType="dijit.Tooltip" 
					connectId="p_[% x _ y %]"
					label="[% INCLUDE party/summary.html party=parties.$x.$y %]"></div>
				[% END %]
			[% ELSIF can_move_to_sector %]
			    .
			[% END %]
			
			[% IF current_location.id == sector.dungeon_grid_id %]
				<span style="z-index: 50; position: absolute; top: 0px; left: 0px;"><img src="[% c.config.static_path %]/images/dungeon/partyloc_t.PNG" border=0  width=[% size %] height=[% size %]></span>
			[% END %]			
			
			</div>
			
			[% IF can_move_to_sector %]</a>[% END %]	
			
			[% FOREACH door IN sector.doors %]
				[% IF door.type != 'secret' || door.state == 'open' %]
			
					[% left_offset = 0 %]
					[% width_offset = 0 %]
					[% top_offset = 0 %]
					[% height_offset = 0 %]
					[% position = door.position.position %]
				
					[% IF position == 'right' ||  position == 'left' %]
						[% height = door_length %]
						[% width = door_thickness %]
						[% height_offset = 2 %]
					[% ELSE %]
						[% height = door_thickness %]
						[% width = door_length %]
						[% width_offset = 2 %]
					[% END %]
				
					[% IF position == 'right' %]
						[% left_offset = 1 %]
						[% width_offset = 0 - width + 1 %]
					[% ELSIF position == 'left' %]
						[% left_offset = 0 %]
						[% width_offset = 1 %]
					[% ELSIF position == 'bottom' %]
						[% top_offset = 1 %]
						[% height_offset = 0 - height + 1 %]
					[% END %]
					
	         		<div 
					   style="
						position: absolute;
						width: [% width %];
						height: [% height %];
						background: black;
						left: [% left_offset * size + width_offset %];
						top: [% top_offset * size + height_offset %];"
					>					
					</div>			
				[% END %]			
			[% END %]
	[% END %]
[% END %]