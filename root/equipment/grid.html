[% MACRO make_grid(class, height, width) BLOCK %]
	[% x = 0 %]
	[% y = 0 %]
	[% WHILE y < height %]
		[% y = y + 1 %]
		[% WHILE x < width %]
			[% x = x + 1 %]
			
			<div class="[% class %]" idPrefix="[% class %]" id="[% class %]-[% x %]-[% y %]" sectorX="[% x %]" sectorY="[% y %]" style="float: left; border: 1px solid #2F2F2F; height: 40px; width: 40px; text-align: center">		
			</div>
			
		[% END %]
		<br style="clear: left"/>
		[% x = 0 %]
	[% END %]
[% END %]

[% MACRO populate_grid(class, items_in_grid) BLOCK %]
	[% FOREACH item_data IN items_in_grid %]
		[% item = item_data.value %]
		[% coords = item_data.key.split(',') %]
		[% item_div(class, item, coords) %]
	[% END %]
[% END %]

[% MACRO item_div(class, item, coords) BLOCK %]
	[% left = 0 %]
	[% top = 0 %]
	[% IF coords %]
		[% left  = (coords.1 - 1) * 42 + 1 %]
		[% top = (coords.0 - 1) * 42 + 1 %]
		[% extra = "position: absolute" %]
	[% END %]

	<div id="item-[% item.id %]" class="[% class %]-item"
		itemHeight="[% item.item_type.height %]" itemWidth="[% item.item_type.width %]" 
		style="[% extra %]; left: [% left %]px; top: [% top %]px; 		
			width: [% item.item_type.width * 40 + (item.item_type.width - 1)  %]px; height: [% item.item_type.height * 40 + (item.item_type.height - 1) %]px; 
			background: url('[% c.config.static_path %]/images/items/[% item.item_type.image %]') center center no-repeat;">
	</div>
[% END %]

[% MACRO create_grid(grid_type, items_in_gird, height, width) BLOCK %]
	<div style="position: relative; float: left" id="[% grid_type %]-grid">
		[% make_grid(grid_type, height, width) %]
		[% populate_grid(grid_type, items_in_grid) %]
	</div>
[% END %]