
[% IF ! garrison %]
<b>Garrison Name (optional)</b>: <input type="text" id="garrison-name" value="[% garrison.name %]" size="50">
<br><br>
[% ELSE %]
<div dojoType="dijit.Dialog" id="change-name-diag" style="display: none" title="Change Garrison's Name" execute="changeName(arguments[0]);">
    Change Garrison's Name To: <input type="text" value="[% garrison.name | html_entity %]" dojoType=dijit.form.TextBox id="garrison-name" name="garrison_name">
    <input id="garrison-id" name="garrison_id" dojoType=dijit.form.TextBox type="hidden" style="display: none" value="[% garrison.id %]">
	<br>
	<div align="center">
    	<button dojoType=dijit.form.Button type="submit">OK</button>
		<button dojoType=dijit.form.Button onclick="dijit.byId('change-name-diag').hide()">Cancel</button>
	</div>
</div>

<h1><span id="name-header">[% garrison.display_name(1) %]</span> <a href="javascript:dijit.byId('change-name-diag').show()" class="main">Change</a></h1>
[% END %]

<div [% UNLESS garrison.characters %]style="display: none"[% END %] id="garrison-list-outer">
	<h3>Characters in the Garrison</h3>
	
	<table class="main" id="garrison-list">
	<tr>
	    [% INCLUDE party/party_list_header.html %]
	    [% IF garrison %]<th>Orders</th>[% END %]
	</tr>
	
	[% FOREACH char IN garrison.characters %]
		<tr id="char_row_[% char.id %]">
		[% INCLUDE party/party_list_char_line.html %]
		<td>
			<select onChange="saveCharacterOrder(this, '[% char.id %]')">
				[% options = ['Attack','Defend'] %]
				[% FOREACH option IN options %]
					<option [% IF char.last_combat_action == option %]selected[% END %]>[% option %]</option>
				[% END %]
			</select>
		</td>
		[% IF editable %]
		<td>
			<div id="char_link_[% char.id %]"><a href="javascript:removeFromGarrison('[% char.id %]')">Remove from Garrison</a></div>
		</td>
		[% END %]
		</tr>
	[% END %]
	</table>
</div>

[% IF editable %]
	<hr size=1>

	<h3>Characters in your Party</h3>
	
	<table class="main" id="party-list">
	<tr>
        [% INCLUDE party/party_list_header.html %]
		[% IF garrison %]<th></th>[% END %]
	    <th>XP</th>
	</tr>
	
	[% FOREACH char IN party.characters %]
		<tr id="char_row_[% char.id %]">
		[% INCLUDE party/party_list_char_line.html %]
		[% IF garrison %]
		<td>
			<select onChange="saveCharacterOrder(this, '[% char.id %]')">
				[% options = ['Attack','Defend'] %]
				[% options.push('Cast') IF char.is_spell_caster %]
				[% FOREACH option IN options %]
					<option [% IF char.last_combat_action == option %]selected[% END %]>[% option %]</option>
				[% END %]
			</select>
		</td>
		[% END %]
		<td>
			<div id="char_link_[% char.id %]"><a href="javascript:addToGarrison('[% char.id %]')">Add To Garrison</a></div>
		</td>
		</tr>
	[% END %]
	</table>
	
	<br>
	<div align="center">
		<button onClick="changes=false; postGarrisonForm()">[% IF garrison %]Update[% ELSE %]Create[% END %] Garrison</button>
		[% IF garrison %]<button onClick="confirmRemoveGarrison()">Remove Garrison</button>[% END %]
	</div>
	
[% END %]

	