[% INCLUDE top.html %]

<script>
function addToGarrison() {
	moveOption('in-party-select', 'in-garrison-select');
}

function removeFromGarrison() {
	moveOption('in-garrison-select', 'in-party-select');
}

function moveOption(sourceId, destId) {
	var source = dojo.byId(sourceId);
	var dest = dojo.byId(destId);
	
	var selected = new Array();
	for (var i = 0; i < source.options.length; i++) {
		if (source.options[ i ].selected) {
			selected.push(source.options[ i ]);
		}
	}
	
	for (var i = 0; i < selected.length; i++) {
		option = selected[ i ];
		try {
			dest.add(option, null);
		}
		catch(ex) {
			dest.add(option); // IE == fail
		}		
	}	
}

function selectAll() {
	var select = dojo.byId('in-party-select');
	for (var i = 0; i < select.options.length; i++) {
		select.options[ i ].selected = true;
	}

	select = dojo.byId('in-garrison-select');
	for (var i = 0; i < select.options.length; i++) {
		select.options[ i ].selected = true;
	}
}
</script>

<h3>[% IF garrison %]Manage[% ELSE %]Create a[% END %] Garrison</h3>

<div style="min-height: 300px">

<form method="POST" action="[% base %]/garrison/create" id="garrison-form" onSubmit="selectAll()">

<fieldset style="float: left">
<legend>Assign Characters</legend>

<table class="main">
	<tr><td>
	<b>In Party</b><br>
	<select multiple="multiple" name="in_party" id="in-party-select" style="height: 200px; width: 250px">
		[% FOREACH character IN characters %]
			[% UNLESS character.is_dead %]
				<option value="[% character.id %]">[% character.name %] ([% character.class.class_name %], lvl[% character.level %])</option>
			[% END %]
		[% END %] 
	</select>
</td><td>
	<button onClick="addToGarrison(); return false">>></button><br>
	<button onClick="removeFromGarrison(); return false"><<</button>
</td><td>
	<b>In Garrison</b><br>
	<select multiple="multiple" name="in_garrison" id="in-garrison-select" style="height: 200px; width: 250px">
		 [% FOREACH character IN garrison.characters %]
		 	<option value="[% character.id %]">[% character.name %] ([% character.class.class_name %], lvl[% character.level %])</option>
		 [% END %]		 
	</select>

</td></tr>
</table>

</fieldset>

<fieldset>
<legend>Set Orders</legend>
<table class="main">
	<tr>
		<td>Orders against creatures:</td>
		<td>
			<select name="creature_attack_mode">
				<option>Defensive Only</option>
				<option>Attack Weaker Opponents</option>
				<option>Attack Similar Opponents</option>
				<option>Attack Stronger Opponents</option>
			</select>
		</td>
	</tr>
	<tr>
		<td>Orders against parties:</td>
		<td>
			<select name="party_attack_mode">
				<option>Defensive Only</option>
				<option>Attack Weaker Opponents</option>
				<option>Attack Similar Opponents</option>
				<option>Attack Stronger Opponents</option>
			</select>
		</td>
	</tr>			
	<tr id="flee-threshold">
		<td>Flee Threshold:</td>
		<td><input type="text" name="flee_threshold" size="3">
		<div dojoType="dijit.Tooltip"
           		connectId="flee-threshold"
           		id="flee-threshold-tooltip"
				style="display: none">
			Percentage of hit points remaining before characters in this garrison will attempt to flee from combat.<br>
			If a garrison flees, they will move to an adjacent sector and form a new garrison. Any items stashed at the<br>
			original garrison will be lost.			 
		</div>		
	</tr>
</table>

</fieldset>
<br>
<div align="center">
	<input type="submit" value="[% IF garrison %]Update[% ELSE %]Create[% END %] Garrison" name="submit">
	<button onClick="document.location='[% base %]'; return false;">[% IF garrison %]Done[% ELSE %]Cancel[% END %]</button>
</div>

</div>

</form>

[% INCLUDE bottom.html %]
