[% INCLUDE top.html %]

<script>
    dojo.require("dijit.form.Form");
    dojo.require("dijit.form.Button");
	dojo.require("dijit.form.NumberTextBox");
	dojo.require("dijit.form.FilteringSelect");
	dojo.require("dojo.data.ItemFileReadStore");
	
</script>

<h2>Create A Kingdom Quest</h2>

<div dojoType="dijit.form.Form" action="[% base %]kingdom/new_quest" method="POST" id="quest-form">

Type Of Quest:
<select dojoType="dijit.form.FilteringSelect" name="quest_type_id" autocomplete="false" 
	onChange="document.location='[% base %]kingdom/new_quest?quest_type_id=' + this.value">
	<option></option>
	[% FOREACH type IN quest_types %]
		<option value="[% type.id %]">[% type.description %]</option>
	[% END %]
</select>

<br><br>
[% current_type.long_desc %]
<br><br>
	
	[% IF params.size > 0 %]
		<fieldset>
		<legend>Quest Parameters</legend>
		<table class="main">
		
		<tr>
			<td>Party To Offer To:</td>
			<td>				
				<div jsId="party_store" dojoType="dojo.data.ItemFileReadStore" 
					 url="[% base %]kingdom/parties_to_offer?quest_type_id=[% current_type.id %]"></div>
				<select dojoType="dijit.form.FilteringSelect" name="quest_party_id"
				        store = "party_store"
				        id="quest_party_id" id="quest_party_id"></select>
			</td>
		</tr>		
		
		[% FOREACH param IN params %]
			<tr>
				<td>[% param.quest_param_name %]:
				[% IF param.min_val %]
					<br>(Min: [% param.min_val %], Max: [% param.max_val %])
				[% END %] 
				</td> 
				<td>
			[% IF param.variable_type == 'int' %]
				<input type="text" dojoType="dijit.form.NumberTextBox" name="param_[% param.id %]" style="width: 50px"
					constraints="{min:[% param.min_val %],max:[% param.max_val %],places:0}" required="true"
					invalidMessage="[% param.quest_param_name %] must be between [% param.min_val %] and [% param.max_val %]">
			[% ELSIF param.variable_type == 'Land' %]
				x: <input type="text" dojoType="dijit.form.NumberTextBox" name="param_[% param.id %]" style="width: 30px" required="true">
				y: <input type="text" dojoType="dijit.form.NumberTextBox" name="param_[% param.id %]" style="width: 30px" required="true">
			[% ELSE %]
				<div jsId="store[% param.id %]" dojoType="dojo.data.ItemFileReadStore" 
					 url="[% base %]kingdom/quest_param_list?quest_param_name_id=[% param.id %]"></div>
				<select dojoType="dijit.form.FilteringSelect" name="param_[% param.id %]"
				        store="store[% param.id %]"
				        id="param_[% param.id %]"></select>
				
			[% END %]		
			</td></tr>
		[% END %]
		
		<tr>
			<td>Gold Reward:</td>
			<td><input type="text" dojoType="dijit.form.NumberTextBox" name="gold_value" style="width: 50px"
					constraints="{min:0,places:0}" required="true" invalidMessage="Please enter a valid value for gold">
			</td>
		</tr>
		<tr>
			<td>Days To Complete:<br>(Min: 5, Max: 30)</td>
			<td><input type="text" dojoType="dijit.form.NumberTextBox" name="days_to_complete" style="width: 50px"
					constraints="{min:5,max:30,places:0}" required="true"
					invalidMessage="Please enter a valid value for days to complete">
			</td>
		</tr>		
		
		</fieldset>
		</table>
		
		<button dojoType="dijit.form.Button" type="submit" name="submitButton">
			Create Quest
		</button>			
		
	[% END %]

</div>

[% INCLUDE bottom.html %]