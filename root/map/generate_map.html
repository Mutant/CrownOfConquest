[% MACRO sector_title(position) BLOCK %][% position.terrain_name | ucfirst %]
[% IF position.town_id %] - [% position.town_name %] (prosperity: [% position.prosperity %])[% END %]
[% IF click_to_move %] ([% position.party_movement_factor %])[% END %]
([% position.x %], [% position.y %])
[% END %]

<table border="1" cellpadding=0 cellspacing=0 align="center">
<tr>
    <td></td>
</tr>
[% FOREACH y IN y_range %]
    <tr>
	[% FOREACH x IN x_range %]
		[% position = grid.$x.$y %]        
        [% IF position %]            
        <td [% IF position.land_id == current_position.id %]id="map_current_pos"[% END %] class="map_square" [% IF position.town_id %]style="background: lightgrey"[% END %]>
            [% FILTER collapse %]    
        	[% IF click_to_move && position.next_to_centre && ! party_in_combat %]
        		<a href="#" onclick="getPanels('/map/move_to?land_id=[% position.land_id %]')"">
        	[% ELSIF ! click_to_move %]
        		<a href="?center_x=[% position.x %]&center_y=[% position.y %]">
        	[% END %]
			<img src="[% c.config.static_path %][% image_path %][% position.image %]" border=0 title="[% sector_title(position) %]">
			[% IF ! click_to_move || position.next_to_centre %]
				</a>
        	[% END %]
        	[% END %]
	        </td>
        [% ELSE %]
        	<td width=35>&nbsp;</td>        
        [% END %]
    [% END %]
    </tr>
[% END %]
</table>
