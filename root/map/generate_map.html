[% MACRO sector_title(position) BLOCK %][% position.terrain_name | ucfirst %]
[% IF position.town_id %] - [% position.town_name %] (prosperity: [% position.prosperity %])[% END %]
[% IF click_to_move %] ([% position.party_movement_factor %])[% END %]
([% position.x %], [% position.y %])
[% END %]

[%
	image_width = 96 / zoom_level
	image_height = 80 / zoom_level
	sector_width = image_width + 2;
	sector_height = image_height + 2;
	min_width = (sector_width + 3) * grid_size;
	min_height = (sector_height + 2) * grid_size;
%]

<style>
.container2 {position:relative; min-width:[% min_width %]px; min-height: [% min_height %]}
.holder2 {display:block; color:#000;}

* html .container2 {border-right:[% min_width %]px solid #fff;}
* html .holder2 {float:left; position:relative; margin-right:-[% min_width %]px;}
</style>

<div class="container2">
<div class="holder2">

[% FOREACH y IN y_range %]
	<div style="clear: left;">
	[% FOREACH x IN x_range %]
		[% position = undef %]
		[% IF x > 0 && y > 0 %]
			[% position = grid.$x.$y %]
		[% END %] 
		<!-- pos [% x %], [% y %] - [% position.land_id %]-->
		[% FILTER collapse %]
        	[% border_colour = 'gray' %]
        	[% IF position.land_id == current_position.id %]
        		[% border_colour= 'blue' %]
        	[% END %]
	
		    [% IF click_to_move && position.next_to_centre && ! party_in_combat %]
	       		<a href="#" onclick="getPanels('/map/move_to?land_id=[% position.land_id %]')"">
	       	[% ELSIF ! click_to_move %]
        		<a href="?center_x=[% x %]&center_y=[% y %]&zoom_level=[% zoom_level %]">
	       	[% END %]
    
        	
			<span style="			
					width: [% sector_width %]px; 
					height: [% sector_height %]px;
					float: left; 			
					text-align: center;
					display: inline;
					border: 1px solid [% border_colour %];
					font-size: 1px;
					[% IF position.town_id %]background: lightgrey;[% END %]
					"					
					>
					[% IF position %]
						<img 
							src="[% c.config.static_path %][% image_path %][% position.image %]" 
							border=0 
							title="[% sector_title(position) %]" 
							width="[% image_width %]"
							height="[% image_height %]"
						>
					[% END %]
					</span>
			[% IF ! click_to_move || position.next_to_centre %]
				</a>
        	[% END %]
        [% END %]
	[% END %]
	</div>
[% END %]
</div>
</div>
