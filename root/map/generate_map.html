[% MACRO sector_title(position) BLOCK %][% position.terrain_name | ucfirst %]
[% IF position.town_id %] - [% position.town_name %] (prosperity: [% position.prosperity %])[% END %]
[% IF click_to_move %] ([% position.party_movement_factor %])[% END %]
([% position.x %], [% position.y %])
[% END %]

[%
	sector_width = 96 / zoom_level;
	sector_height = 80 / zoom_level;
%]

<div style="position: relative; width: [% x_size * sector_width %]px; height: [% y_size * sector_height %]px; margin: 1px auto">
	
	
[% FOREACH y IN y_range %]

	[% FOREACH x IN x_range %]
		[% position = grid.$x.$y %] 
		<!-- pos [% x %], [% y %] -->
		[% FILTER collapse %]
        	[% border_colour = 'gray' %]
        	[% IF position.land_id == current_position.id %]
        		[% border_colour= 'blue' %]
        	[% END %]
	
		    [% IF click_to_move && position.next_to_centre && ! party_in_combat %]
        		<a href="#" onclick="getPanels('/map/move_to?land_id=[% position.land_id %]')"">
        	[% ELSIF ! click_to_move %]
        		<a href="?center_x=[% x %]&center_y=[% y %]&zoom_level=[% zoom_level %]">
        	[% END %]
        	
			<div style="			
					width: [% sector_width %]px; 
					height: [% sector_height %]px; 
					position: absolute;
					left: [% (x - min_x) * sector_width %]px; 
					top: [% (y - min_y) * sector_height %]px;					
					text-align: center;
					border: 1px solid [% border_colour %];
					[% IF position.town_id %]background: lightgrey;[% END %]
					"					
					>
					[% IF position %]
						<img 
							src="[% c.config.static_path %][% image_path %][% position.image %]" 
							border=0 
							title="[% sector_title(position) %]" 
							width="[% sector_width %]"
							height="[% sector_height %]"
						>
					[% END %]
					</div>
			[% IF ! click_to_move || position.next_to_centre %]
				</a>
        	[% END %]
        [% END %]
	[% END %]
[% END %]

</div>

