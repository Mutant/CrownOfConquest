[% PROCESS layout/diag_buttons.html %]

<div dojoType="dijit.Dialog" id="declare-kingdom-diag" style="display: none" title="Declare Kingdom" execute="return true;">
	<form method="post" action="[% base %]kingdom/create" onSubmit="postPanels(this); return false">
	<table class="main">
		<tr>
			<td>Kingdom Name:</td>
			<td><input name="kingdom_name" dojoType=dijit.form.TextBox type="text" value="" style="width: 250px"></td>
		</tr>
		<tr>
			<td>King / Queen:</td>
			<td><select name="king" dojoType="dijit.form.FilteringSelect">
				[% FOREACH character IN party.characters_in_party %]
					[% UNLESS character.is_dead %]
						<option value="[% character.id %]">[% character.name %]</option>
					[% END %]
				[% END %]
				</select>
			</tr>
		</tr>
	</table>    
	[% dialog_buttons('declare-kingdom-diag') %]
	</form>
</div>

<h4>Allegiance</h4>

[% PROCESS kingdom/loyalty_rating.html %]

[% IF kingdom %]
	[% king = kingdom.king %]
	We are loyal to the Kingdom of [% kingdom.name | collapse %].<br>
	Our monarch is: [% king.name %] ([% IF king.party_id %][% king.party.name %][% ELSE %]NPC[% END %])<br>
	Our loyalty rating: [% display_loyalty_rating(party.loyalty_for_kingdom(kingdom.id)) %]<br>
	<a href="javascript:loadScreen('kingdomboard/view')">Discussion Board</a>
[% ELSE %]
	We are Free Citizens, loyal to no one.
[% END %]

<br><br>
We can change our allegiance once every [% allegiance_change_frequency %] days. 

[% IF party.last_allegiance_change %]
	We last changed it [% party.days_since_last_allegiance_change %].
[% ELSE %]
	So far, we have not changed our allegiance.
[% END %]

[% IF ! in_combat %]
<form method="POST" action="[% base %]party/details/change_allegiance" onSubmit="postPanels(this); return false">
Change our allegiance to: 
	<select dojoType="dijit.form.FilteringSelect" name="kingdom_id" autocomplete="false" style="width: 250px">
		[% IF kingdom %]<option value="">None (Become Free Citizens)</option>[% END %]
		[% FOREACH kingdom IN kingdoms %]
        	<option value="[% kingdom.id %]" class="main">[% kingdom.name %]</option>
		[% END %]
	</select>
	<input type="submit" value="Change">
</form>
[% ELSE %]
<br><br>You cannot change your allegiance while you're in combat.
[% END %]

[% IF banned.size > 0 %]
<br>
We have been banished from the following kingdoms:
<ul>
[% FOREACH banished IN banned %]
<li>Kingdom of [% banished.kingdom.name %] ([% banished.banished_for %] more days)</li>
[% END %]
</ul>
[% END %]

[% IF mayor_count > 0 %]
	<br>
	We currently have [% mayor_count %] mayors. [% town_count_for_kingdom_declaration %] mayors (and a party level of [% minimum_kingdom_level %])
	are required in order to declare a Kingdom.
	
	[% IF can_declare_kingdom && ! in_combat %]
		<br><br>
		<button dojoType="dijit.form.Button" onClick="dijit.byId('declare-kingdom-diag').show()">Declare Kingdom</button>
	[% END %]

[% END %] 