<script>
function selectAction(action, char_id) {
	dojo.xhrGet( { //
	        // The following URL must match that used to test the server.
	        url: "[% base %]/combat/select_action?action=" + action + "&character_id=" + char_id, 
	        handleAs: "text",
	
	        timeout: 5000, // Time in milliseconds
	
	        });

    // Ugly, but effective :|
	document.getElementById('attack-' + char_id).style.border = "solid white 1px";
	document.getElementById('defend-' + char_id).style.border = "solid white 1px";
	        
	document.getElementById(action.toLowerCase() + '-' + char_id).style.border = "solid black 1px";
	        
	return false;
}

function loadActions() {
	[% FOREACH action IN combat_actions %]
	var action = document.getElementById("[% action.value %]".toLowerCase() + '-' + "[% action.key %]");
	
	if (action) {
		action.style.border = "solid black 1px";
	}
	[% END %]
}

function processOnLoad() {
	loadActions();
}

</script>

<style>
	.highlighted: {
		background: #222222;
	}
</style>

<table>
<tr>
    <th>Name</th>
    <th>Race</th>
    <th>Class</th>
    <th>HP</th>
    <th>XP</th>
    <th>S</th>
    <th>I</th>
    <th>A</th>        
    <th>D</th>
    <th>C</th>        
</tr>
    
[% FOREACH char = characters %]
<tr>
    <td><a href="[% base %]/character/view?character_id=[% char.character_id %]">[% char.character_name %]</a></td>
    <td>[% char.race.race_name %]</td>
    <td>[% char.class.class_name %]</td>
    <td>[% char.hit_points %] / [% char.max_hit_points %]</td>
    <td>[% char.xp %]</td>
    <td>[% char.strength %]</td>
    <td>[% char.intelligence %]</td>
    <td>[% char.agility %]</td>
    <td>[% char.divinity %]</td>
    <td>[% char.constitution %]</td>
    
    [% IF party.in_combat_with && ! char.is_dead %]
    	<td id="attack-[% char.id %]"><a href="#" onClick="selectAction('Attack','[% char.id %]')">Attack</a></td>
    	<td id="defend-[% char.id %]"><a href="#" onClick="selectAction('Defend','[% char.id %]')">Defend</a></td>
    [% END %]
</tr>
[% END %]
</table>