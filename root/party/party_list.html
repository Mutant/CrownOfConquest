[% USE infl = Lingua.EN.Inflect; %]

<script>
function createMenus() {
	if (dijit.byId('action_menu') != undefined) {
		dijit.byId('action_menu').destroyRecursive();			
	}
	
	var params = {id:"action_menu" };

	var menu = new dijit.Menu(params,document.createElement("div"));
	
	[% FOREACH opponent IN opponents %]
		var menuItem = new dijit.MenuItem({
            label: "[% opponent.name %]",
            onClick: function() {
                alert("[% opponent.name %]");
            }
        });
        menu.addChild(menuItem);
    [% END %]
    
     var button = new dijit.form.DropDownButton({
            label: "<img src=[% c.config.static_path %]/images/actions/attack.png>",
            dropDown: menu,
            class: "actionButton" 
           
        });
        
     [% FOREACH character IN characters %]
     dojo.byId("fightMenu_[% character.id %]").appendChild(dojo.clone(button.domNode));
     [% END %]

}

dojo.addOnLoad( createMenus );
</script>

<div style=""> 

<table [% UNLESS in_combat %]dojoType="dojo.dnd.Source"[% END %] 
	id="party-table" accept="character" moveOnly="true" class="main" align="center" cellspacing=0 cellpadding=2>

	<tr>
		<td colspan="8">
		[% IF party.party_effects %]
		Party Effects: 
			[% FOREACH effect IN party.party_effects %]
				[% effect.effect.effect_name %] ([% FILTER inflect %]NO([% effect.effect.time_type %], [% effect.effect.time_left %])[% END %] left )
				[% UNLESS loop.last %],[% END %]
			[% END %]
		<br>
		[% END %] 
		<br>
		</td>
	</tr>
		
	
<tr>
	<td colspan="8">
		<h3>Party Members</h3>
	</td>
</tr>
<tr>
	[% INCLUDE party/party_list_header.html %]
	<th>Effects</th>
</tr>

[% FOREACH char IN characters %]
[% char_id = char.id %]

<tr 
	[% UNLESS in_combat %]class="dojoDndItem"[% END %] 
	dndType="character" 
	accept="character"
	id="char-[% char.id %]" 
	jsId="char-[% char.id %]" 
	[% IF char.is_dead %]style="background: black"[% END %]
>	
	[% INCLUDE party/party_list_char_line.html %]
    <td nowrap="nowrap">[% FOREACH effect IN char.character_effects %][% effect.effect.effect_name %] ([% effect.effect.time_left %])[% UNLESS loop.last() %],[% END %][% END %]</td>

	<td align="center">
    [% UNLESS char.is_dead %]
		<div id="char_action_holder_[% char.id %]" class="main"></div>    
	[% ELSE %]
		[% UNLESS in_combat %]
			<button dojoType="dijit.form.Button" onclick="buryDiag('[% char.character_name | replace("'","\\'") %]', '[% char.character_id %]')">Bury</button>
		[% END %]
    [% END %]

	</td>

    [% IF in_combat %]
    	<td>
    		<span id="fightMenu_[% char.id %]"></span>
    		<img src="[% c.config.static_path %]/images/actions/defend.png">
    		<img src="[% c.config.static_path %]/images/actions/cast.png">
    		<img src="[% c.config.static_path %]/images/actions/use.png">
    	</td>
    [% END %]

    [% IF party.rank_separator_position == char.party_order %]
    	</tr>
    	<tr>
    		<tr [% UNLESS in_combat %]class="dojoDndItem"[% END %] dndType="separator" id="rank_separator" jsId="rank_separator">
    			<td colspan="10"></td>
    [% END %]
   
</tr>
[% END %]

</table>
</div>